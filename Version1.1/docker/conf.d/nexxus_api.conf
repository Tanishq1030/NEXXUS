server {
    listen 80;
    server_name _; # Catch-all server name

    # Override global error_log for this server block to enable debug logging for API requests
    # The global error_log in nginx.conf is set to 'warn'
    error_log /var/log/nginx/error.log debug;

    # Access log will use the 'main' format defined in the http block in nginx.conf

    # For any requests to the root or unmatched paths by other locations, return 404
    location / {
        return 404;
    }

    # Proxy API requests to the fastapi backend
    # With the change below, requests to /v1/api/some/endpoint will be forwarded to http://fastapi:8000/v1/api/some/endpoint
    location /v1/api/ {
        proxy_pass http://fastapi:8000;   # Removed trailing slash to preserve the /v1/api/ prefix
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        # proxy_set_header X-Script-Name /v1/api; # Optional: Informs backend about original base path
    }
}